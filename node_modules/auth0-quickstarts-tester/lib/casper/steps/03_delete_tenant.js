const MAIN_TENANT_NAME = "brokkr-test";

function _deleteTenant(casper, test, tenantName) {
  casper.then(function () {
    casper.echo("Deleting tenant with name: " + tenantName);
    casper.waitForUrl("https://manage.auth0.com/#/", null, null, 10000);
    casper.waitUntilVisible(".dropdown.tenant-dropdown .btn-dro.btn-username", function () {
      this.click(".dropdown.tenant-dropdown .btn-dro.btn-username");
    }, null, 10000);
    casper.wait(1000, function () {
      this.capture('screenshots/DELETE/01.png');
      this.click(".dropdown.tenant-dropdown.open .tenant-menu-item a[href='#/tenant']");
    });
    casper.waitUntilVisible(".nav.nav-tabs #nav-advanced a[href='#/tenant/advanced']", function () {
      this.click(".nav.nav-tabs #nav-advanced a[href='#/tenant/advanced']");
    }, null, 10000);
    casper.waitForUrl("https://manage.auth0.com/#/tenant/advanced", null, null, 5000);
    casper.waitUntilVisible("#tenant-advanced .btn.btn-danger.btn-large.delete-account", function () {
      this.capture('screenshots/DELETE/02.png');
      this.click("#tenant-advanced .btn.btn-danger.btn-large.delete-account");
    }, null, 5000);
    casper.waitUntilVisible("#confirm-delete-account .tenant.controls #confirm-tenant", function () {
      this.scrollTo(0, 0);
      test.assertSelectorDoesntHaveText(".form-horizontal .modal-body .tenant-delete-confirm-info", MAIN_TENANT_NAME, "Should not be trying to delete Main Tenant.");
      this.sendKeys("#confirm-delete-account .tenant.controls #confirm-tenant", tenantName);
      this.capture('screenshots/DELETE/03.png');
      this.click("#confirm-delete-account .modal-footer .btn.btn-danger.confirm");
    }, null, 5000);
    casper.wait(10000);
    casper.waitForUrl("https://manage.auth0.com/#/", null, null, 10000);
  });
}

module.exports = _deleteTenant;
