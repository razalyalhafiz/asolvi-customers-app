function _createTenant(casper, test, tenantName) {
  casper.then(function () {
    casper.echo("Creating tenant with name: " + tenantName);
    casper.waitForUrl("https://manage.auth0.com/#/", null, null, 10000);
    casper.waitUntilVisible(".dropdown.tenant-dropdown .btn-dro.btn-username", function () {
      this.click(".dropdown.tenant-dropdown .btn-dro.btn-username");
    }, null, 10000);
    casper.wait(1000, function () {
      this.capture('screenshots/CREATE/01.png');
      this.click(".dropdown.tenant-dropdown.open .new_account");
    });
    //New tenant form is shown
    casper.waitUntilVisible("#create-app-form .input-small.form-control", function () {
      this.scrollTo(0, 0);
      this.click("#create-app-form .input-small.form-control");
      this.sendKeys("#create-app-form .input-small.form-control", tenantName);
      this.click("#regions-selector .btn.btn-default[data-value='stage']");
      this.click(".terms.terms-with-checkbox .auth[name=mcc]");
      this.click("#create-app-form.form-horizontal .btn.btn-success");
      this.capture('screenshots/CREATE/02.png');
    });
    casper.wait(2000, function () {
      test.assertNotVisible('#configure-app .modal-content .alert.alert-danger .error-message', "Should not have 'Tenant name not available' error message.");
    });
    casper.waitForUrl("https://manage.auth0.com/#/");
    casper.wait(5000, function () {
      this.capture('screenshots/CREATE/03.png');
    });
  });
}

module.exports = _createTenant;
