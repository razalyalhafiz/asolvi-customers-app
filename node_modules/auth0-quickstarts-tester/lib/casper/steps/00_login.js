const MAIN_TENANT_EMAIL = casper.cli.options.email || "missingemail";
const MAIN_TENANT_PASSWORD = casper.cli.options.password || "missingpassword";

function _signInMainTenant(casper, test) {
  casper.waitUntilVisible("form input.auth0-lock-input[type=email]", function () {
    this.sendKeys("form input.auth0-lock-input[type=email]", MAIN_TENANT_EMAIL);
    this.sendKeys("form input.auth0-lock-input[type=password]", MAIN_TENANT_PASSWORD);
    this.capture('screenshots/LOGIN/01.png');
  }, null, 10000)
    .waitUntilVisible("form button.auth0-lock-submit", function () {
      this.click("form button.auth0-lock-submit");
    }, null, 10000)
    .wait(2000, function () {
      test.assertNotVisible('.a0-header.a0-top-header .a0-error', "Lock doesn't show errors (A)");
      test.assertNotVisible('.auth0-global-message.auth0-global-message-error', "Lock doesn't show errors (B)");
    })
    .waitForUrl("https://manage.auth0.com/#/", function () {
      this.capture('screenshots/LOGIN/02.png');
    }, null, 10000);
}

module.exports = _signInMainTenant;
