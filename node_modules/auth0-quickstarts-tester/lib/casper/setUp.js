var auth0 = require('./steps');
casper.options.viewportSize = { width: 1600, height: 950 };
casper.on('page.error', function (msg, trace) {
  this.echo('Error: ' + msg, 'ERROR');
  for (var i = 0; i < trace.length; i++) {
    var step = trace[i];
    this.echo('   ' + step.file + ' (line ' + step.line + ')', 'ERROR');
  }
});
casper.on('test.fail', function () {
  casper.capture('screenshots/fail.png');
});

const NEW_TENANT_NAME = casper.cli.options.tenant || "test-dashboard-" + parseInt(Math.random() * 100) + Date.now();

casper.test.begin('Should create Test Tenant and extract data', function (test) {

  casper.start('https://manage.auth0.com/login');
  auth0.login(casper, test);
  auth0.createTenant(casper, test, NEW_TENANT_NAME);
  auth0.extractData(casper, test);

  casper.run(function () {
    test.done();
  });
});
